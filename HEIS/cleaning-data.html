<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Cleaning data | Household Expenditure and Income Surveys of Iran</title>
  <meta name="description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Cleaning data | Household Expenditure and Income Surveys of Iran" />
  
  <meta name="twitter:description" content="The Household Expenditure and Income Surveys of Iran: Introduction and data cleaning" />
  

<meta name="author" content="Mohammad Hoseini and Avenia Ghazarian" />


<meta name="date" content="2020-08-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="importing-raw-data.html"/>
<link rel="next" href="price-adjustment-and-appending.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#sample-design"><i class="fa fa-check"></i><b>1.1</b> Sample design</a><ul>
<li class="chapter" data-level="1.1.1" data-path="introduction.html"><a href="introduction.html#rotating-panel-feature"><i class="fa fa-check"></i><b>1.1.1</b> Rotating panel feature</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#different-rounds"><i class="fa fa-check"></i><b>1.2</b> Different rounds</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="questionnaire-details.html"><a href="questionnaire-details.html"><i class="fa fa-check"></i><b>2</b> Questionnaire details</a><ul>
<li class="chapter" data-level="2.1" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-1---member-characteristics"><i class="fa fa-check"></i><b>2.1</b> Part 1 - Member Characteristics</a></li>
<li class="chapter" data-level="2.2" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-2---household-facilities"><i class="fa fa-check"></i><b>2.2</b> Part 2 - Household Facilities</a></li>
<li class="chapter" data-level="2.3" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-3---expenditure"><i class="fa fa-check"></i><b>2.3</b> Part 3 - Expenditure</a></li>
<li class="chapter" data-level="2.4" data-path="questionnaire-details.html"><a href="questionnaire-details.html#part-4-income"><i class="fa fa-check"></i><b>2.4</b> Part 4: Income</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="importing-raw-data.html"><a href="importing-raw-data.html"><i class="fa fa-check"></i><b>3</b> Importing raw data</a><ul>
<li class="chapter" data-level="3.1" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-access-files-to-r"><i class="fa fa-check"></i><b>3.1</b> Importing access files to R</a></li>
<li class="chapter" data-level="3.2" data-path="importing-raw-data.html"><a href="importing-raw-data.html#importing-code-for-all-years"><i class="fa fa-check"></i><b>3.2</b> Importing code for all years</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-data.html"><a href="cleaning-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning data</a><ul>
<li class="chapter" data-level="4.1" data-path="cleaning-data.html"><a href="cleaning-data.html#importing-raw-data-and-sampling-information"><i class="fa fa-check"></i><b>4.1</b> Importing raw data and sampling information</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-1"><i class="fa fa-check"></i><b>4.2</b> Cleaning Part 1</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-2"><i class="fa fa-check"></i><b>4.3</b> Cleaning Part 2</a></li>
<li class="chapter" data-level="4.4" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-3"><i class="fa fa-check"></i><b>4.4</b> Cleaning Part 3</a></li>
<li class="chapter" data-level="4.5" data-path="cleaning-data.html"><a href="cleaning-data.html#cleaning-part-4"><i class="fa fa-check"></i><b>4.5</b> Cleaning Part 4</a></li>
<li class="chapter" data-level="4.6" data-path="cleaning-data.html"><a href="cleaning-data.html#builiding-item-level-data"><i class="fa fa-check"></i><b>4.6</b> Builiding item level data</a></li>
<li class="chapter" data-level="4.7" data-path="cleaning-data.html"><a href="cleaning-data.html#building-individual-level-data"><i class="fa fa-check"></i><b>4.7</b> Building individual-level data</a></li>
<li class="chapter" data-level="4.8" data-path="cleaning-data.html"><a href="cleaning-data.html#building-household-level-data-summary-files"><i class="fa fa-check"></i><b>4.8</b> Building Household-level data (summary files)</a><ul>
<li class="chapter" data-level="4.8.1" data-path="cleaning-data.html"><a href="cleaning-data.html#exporting-to-other-formats."><i class="fa fa-check"></i><b>4.8.1</b> Exporting to other formats.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="cleaning-data.html"><a href="cleaning-data.html#special-issues-for-different-years"><i class="fa fa-check"></i><b>4.9</b> Special issues for different years</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html"><i class="fa fa-check"></i><b>5</b> Price adjustment and appending</a><ul>
<li class="chapter" data-level="5.1" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#price-adjustment"><i class="fa fa-check"></i><b>5.1</b> Price Adjustment</a></li>
<li class="chapter" data-level="5.2" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#merging-individual-level-data-overtime"><i class="fa fa-check"></i><b>5.2</b> Merging individual level data overtime</a></li>
<li class="chapter" data-level="5.3" data-path="price-adjustment-and-appending.html"><a href="price-adjustment-and-appending.html#merging-household-level-data-over-time"><i class="fa fa-check"></i><b>5.3</b> Merging household-level data over time</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="overall-trends.html"><a href="overall-trends.html"><i class="fa fa-check"></i><b>6</b> Overall trends</a><ul>
<li class="chapter" data-level="6.1" data-path="overall-trends.html"><a href="overall-trends.html#trends-in-expenditure-items"><i class="fa fa-check"></i><b>6.1</b> Trends in expenditure items</a></li>
<li class="chapter" data-level="6.2" data-path="overall-trends.html"><a href="overall-trends.html#trends-of-individual-level-data"><i class="fa fa-check"></i><b>6.2</b> Trends of individual level data</a></li>
<li class="chapter" data-level="6.3" data-path="overall-trends.html"><a href="overall-trends.html#trends-of-household-level-data-over-time"><i class="fa fa-check"></i><b>6.3</b> Trends of household-level data over time</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Household Expenditure and Income Surveys of Iran</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-data" class="section level1">
<h1><span class="header-section-number">4</span> Cleaning data</h1>
<style type="text/css">
pre {
  max-height: 500px;
  overflow-y: auto;
}

pre[class] {
  max-height: 500px;
}
</style>
<p>The raw data in <em>rdata</em> format, consists of a number of dataframes each corresponding to a table in the questionnaire. The name of each dataframe informs the user about region, year, part and table number. Forexample, R98P3S01 contains Table 1 (food) of Part 3 (expenditure item) for R (rural) sample of year 98. Our data cleaning process has different steps:</p>
<ul>
<li>for each year of survey we write an script to reconcile variable names and codings.</li>
<li>we match item codes with detailed price index</li>
<li>we merge different rounds and build household and individual level datasets overtime.</li>
</ul>
<p>This chapter describes the structure of script for each survey year and present a sample code written for 1398. The output of each script, in addition to the cleaned raw data, would be 3 <em>.RDS</em> files (which can be easily exported to <em>.csv</em>, <em>.dta</em>, and other formats) including (1) household-level, (2) individual-level, (3) item-level dataframes. For example the script of 1398 survey, takes the raw data of <em>98.Rdata</em> file as input and creates the following 4 files as output:</p>
<ul>
<li><em>HEIS98.Rdata</em> which is the cleaned image of the data</li>
<li><em>HH98.Rds</em> which is the household level data</li>
<li><em>IND98.Rds</em> which is the individual level data</li>
<li><em>EXP98.Rds</em> which is the item level data</li>
</ul>
<p>The year-wise scripts can be downloaded from here: <a href="https://bit.ly/3l7jl14" class="uri">https://bit.ly/3l7jl14</a></p>
<p>In each yearly scripts we do the folling steps:</p>
<ul>
<li>rename variable to have unique names over time</li>
<li>recode expenditure items to have global code over time</li>
<li>merging tables of part 3 to build a unique expenditure dataframe</li>
<li>merging part 1 and part 4 to build individual-level data on characteristics and income</li>
<li>aggregating expenditures and income to make household-level data</li>
</ul>
<div id="importing-raw-data-and-sampling-information" class="section level2">
<h2><span class="header-section-number">4.1</span> Importing raw data and sampling information</h2>
<p>In the first step, we import <em>tidyverse</em> library, clear the memory, and import the raw data. In most years, raw data has a separate file for information about sample like whether it is the original household in the framework, the sample weight etc. In this code, the last two lines regarding Part 1 are for generating variables for province and town codes. The information on the location is available in household ID variables which is titled as “Address” in the surveys. <span style="color:red"> The structure of Address is also changing over time: explain the details here </span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">ls</span>())</a>
<a class="sourceLine" id="cb1-4" title="4"></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">load</span>(<span class="st">&quot;./RAW/98.RData&quot;</span>)</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">##############################</span></a>
<a class="sourceLine" id="cb1-8" title="8">R98Data &lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mah =</span> MahMorajeh, <span class="dt">khanevartype =</span> NoeKhn) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb1-11" title="11">         <span class="dt">town =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb1-12" title="12">U98Data &lt;-<span class="st"> </span>U98Data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">mah =</span> MahMorajeh, <span class="dt">khanevartype =</span> NoeKhn) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>)),</a>
<a class="sourceLine" id="cb1-15" title="15">         <span class="dt">town =</span> <span class="kw">as.integer</span>(<span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>)))</a></code></pre></div>
</div>
<div id="cleaning-part-1" class="section level2">
<h2><span class="header-section-number">4.2</span> Cleaning Part 1</h2>
<p>For part 1, we first define our global codes for member characteristics including relation, gender, literacy, studying, education, occupation, marital such that these variables become comparable overtime. Then we change variable names to have unique names over time. The below code shows the name list of 1398. Finally, we assign our global codes as labels of the variables (levels of factors).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co">##############################</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># Part 1</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">relation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Head=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Spouse=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Child=</span><span class="st">&quot;3&quot;</span>, <span class="dt">SonDaughter_inLaw=</span><span class="st">&quot;4&quot;</span>, <span class="dt">GrandSonDaughter=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Parent=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Sibling=</span><span class="st">&quot;7&quot;</span>, <span class="dt">OtherRelative=</span><span class="st">&quot;8&quot;</span>, <span class="dt">NonRelative=</span><span class="st">&quot;9&quot;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5">gender &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Male=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Female=</span><span class="st">&quot;2&quot;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6">literacy &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">literate=</span><span class="st">&quot;1&quot;</span>, <span class="dt">illiterate=</span><span class="st">&quot;2&quot;</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">yesno &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Yes=</span><span class="st">&quot;1&quot;</span>, <span class="dt">No=</span><span class="st">&quot;2&quot;</span>)</a>
<a class="sourceLine" id="cb2-8" title="8">education &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Elemantry=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Secondary=</span><span class="st">&quot;2&quot;</span>, <span class="dt">HighSchool=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Diploma=</span><span class="st">&quot;4&quot;</span>, <span class="dt">College=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Bachelor=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Master=</span><span class="st">&quot;7&quot;</span>, <span class="dt">PhD=</span><span class="st">&quot;8&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;9&quot;</span>)</a>
<a class="sourceLine" id="cb2-9" title="9">occupation &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">employed=</span><span class="st">&quot;1&quot;</span>, <span class="dt">unemployed=</span><span class="st">&quot;2&quot;</span>, <span class="dt">IncomeWOJob=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Student=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Housewife=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;6&quot;</span>)</a>
<a class="sourceLine" id="cb2-10" title="10">marital &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Married =</span><span class="st">&quot;1&quot;</span>, <span class="dt">Widowed=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Divorced=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Single=</span><span class="st">&quot;4&quot;</span>)</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12">R98P1 &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-14" title="14">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-15" title="15">    <span class="dt">relation =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-16" title="16">    <span class="dt">gender =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-17" title="17">    <span class="dt">age =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-18" title="18">    <span class="dt">literacy =</span> DYCOL06,</a>
<a class="sourceLine" id="cb2-19" title="19">    <span class="dt">studying =</span> DYCOL07,</a>
<a class="sourceLine" id="cb2-20" title="20">    <span class="dt">degree =</span> DYCOL08,</a>
<a class="sourceLine" id="cb2-21" title="21">    <span class="dt">occupationalst =</span> DYCOL09,</a>
<a class="sourceLine" id="cb2-22" title="22">    <span class="dt">maritalst =</span> DYCOL10) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</a>
<a class="sourceLine" id="cb2-24" title="24">         <span class="kw">across</span>(<span class="kw">c</span>(relation,gender,literacy,studying,degree,occupationalst,maritalst), as.factor),</a>
<a class="sourceLine" id="cb2-25" title="25">         <span class="dt">relation =</span> <span class="kw">fct_recode</span>(relation, <span class="op">!!!</span>relation), </a>
<a class="sourceLine" id="cb2-26" title="26">         <span class="dt">gender =</span> <span class="kw">fct_recode</span>(gender, <span class="op">!!!</span>gender),</a>
<a class="sourceLine" id="cb2-27" title="27">         <span class="dt">literacy =</span> <span class="kw">fct_recode</span>(literacy, <span class="op">!!!</span>literacy), </a>
<a class="sourceLine" id="cb2-28" title="28">         <span class="dt">studying =</span> <span class="kw">fct_recode</span>(studying, <span class="op">!!!</span>yesno),</a>
<a class="sourceLine" id="cb2-29" title="29">         <span class="dt">degree =</span> <span class="kw">fct_recode</span>(degree, <span class="op">!!!</span>education), </a>
<a class="sourceLine" id="cb2-30" title="30">         <span class="dt">occupationalst =</span> <span class="kw">fct_recode</span>(occupationalst, <span class="op">!!!</span>occupation),</a>
<a class="sourceLine" id="cb2-31" title="31">         <span class="dt">maritalst =</span> <span class="kw">fct_recode</span>(maritalst, <span class="op">!!!</span>marital))</a>
<a class="sourceLine" id="cb2-32" title="32"></a>
<a class="sourceLine" id="cb2-33" title="33">U98P1 &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb2-35" title="35">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb2-36" title="36">    <span class="dt">relation =</span> DYCOL03,</a>
<a class="sourceLine" id="cb2-37" title="37">    <span class="dt">gender =</span> DYCOL04,</a>
<a class="sourceLine" id="cb2-38" title="38">    <span class="dt">age =</span> DYCOL05,</a>
<a class="sourceLine" id="cb2-39" title="39">    <span class="dt">literacy =</span> DYCOL06,</a>
<a class="sourceLine" id="cb2-40" title="40">    <span class="dt">studying =</span> DYCOL07,</a>
<a class="sourceLine" id="cb2-41" title="41">    <span class="dt">degree =</span> DYCOL08,</a>
<a class="sourceLine" id="cb2-42" title="42">    <span class="dt">occupationalst =</span> DYCOL09,</a>
<a class="sourceLine" id="cb2-43" title="43">    <span class="dt">maritalst =</span> DYCOL10 ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-44" title="44"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</a>
<a class="sourceLine" id="cb2-45" title="45">         <span class="kw">across</span>(<span class="kw">c</span>(relation,gender,literacy,studying,degree,occupationalst,maritalst), as.factor),</a>
<a class="sourceLine" id="cb2-46" title="46">         <span class="dt">relation =</span> <span class="kw">fct_recode</span>(relation, <span class="op">!!!</span>relation), </a>
<a class="sourceLine" id="cb2-47" title="47">         <span class="dt">gender =</span> <span class="kw">fct_recode</span>(gender, <span class="op">!!!</span>gender),</a>
<a class="sourceLine" id="cb2-48" title="48">         <span class="dt">literacy =</span> <span class="kw">fct_recode</span>(literacy, <span class="op">!!!</span>literacy), </a>
<a class="sourceLine" id="cb2-49" title="49">         <span class="dt">studying =</span> <span class="kw">fct_recode</span>(studying, <span class="op">!!!</span>yesno),</a>
<a class="sourceLine" id="cb2-50" title="50">         <span class="dt">degree =</span> <span class="kw">fct_recode</span>(degree, <span class="op">!!!</span>education), </a>
<a class="sourceLine" id="cb2-51" title="51">         <span class="dt">occupationalst =</span> <span class="kw">fct_recode</span>(occupationalst, <span class="op">!!!</span>occupation),</a>
<a class="sourceLine" id="cb2-52" title="52">         <span class="dt">maritalst =</span> <span class="kw">fct_recode</span>(maritalst, <span class="op">!!!</span>marital))</a></code></pre></div>
</div>
<div id="cleaning-part-2" class="section level2">
<h2><span class="header-section-number">4.3</span> Cleaning Part 2</h2>
<p>Cleaning Part 2 is similar to Part 1. First defining global labels for variables, then renaming the variables and assinging the labels to variables. Beacuse many variable in this part are yes-no questions, we change the format of those variable to binary for saving space.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co">##############################</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="co"># Part 2</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">tenure &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">OwnedEstateLand=</span><span class="st">&quot;1&quot;</span>, <span class="dt">OwnedEstate=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Rent=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Mortgage=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Service=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Free=</span><span class="st">&quot;6&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;7&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" title="5">material &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">MetalBlock=</span><span class="st">&quot;1&quot;</span>, <span class="dt">BrickWood=</span><span class="st">&quot;2&quot;</span>, <span class="dt">Cement=</span><span class="st">&quot;3&quot;</span>, <span class="dt">Brick=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;5&quot;</span>, <span class="dt">WoodKesht=</span><span class="st">&quot;6&quot;</span>, <span class="dt">KeshtGel=</span><span class="st">&quot;7&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;8&quot;</span>)</a>
<a class="sourceLine" id="cb3-6" title="6">fuel &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;1&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;2&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;3&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;4&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;5&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;6&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;7&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;8&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;9&quot;</span>, <span class="dt">None=</span><span class="st">&quot;10&quot;</span> )</a>
<a class="sourceLine" id="cb3-7" title="7">fuel1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;11&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;12&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;13&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;14&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;15&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;16&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;17&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;18&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;19&quot;</span>, <span class="dt">None=</span><span class="st">&quot;20&quot;</span> )</a>
<a class="sourceLine" id="cb3-8" title="8">fuel2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Oil=</span><span class="st">&quot;21&quot;</span>, <span class="dt">Gasoline=</span><span class="st">&quot;22&quot;</span>, <span class="dt">LiquidGas=</span><span class="st">&quot;23&quot;</span>, <span class="dt">NaturalGas=</span><span class="st">&quot;24&quot;</span>, <span class="dt">Electricity=</span><span class="st">&quot;25&quot;</span>, <span class="dt">Wood=</span><span class="st">&quot;26&quot;</span>, <span class="dt">AnimalOil=</span><span class="st">&quot;27&quot;</span>, <span class="dt">Coke=</span><span class="st">&quot;28&quot;</span>, <span class="dt">Other=</span><span class="st">&quot;29&quot;</span>, <span class="dt">None=</span><span class="st">&quot;30&quot;</span> )</a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10">R98P2 &lt;-<span class="st"> </span>R98P2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="dt">tenure =</span> DYCOL01,</a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="dt">room =</span> DYCOL03,</a>
<a class="sourceLine" id="cb3-14" title="14">    <span class="dt">space =</span> DYCOL04,</a>
<a class="sourceLine" id="cb3-15" title="15">    <span class="dt">construction =</span> DYCOL05,</a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="dt">material =</span> DYCOL06,</a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="dt">vehicle =</span> DYCOL07,</a>
<a class="sourceLine" id="cb3-18" title="18">    <span class="dt">motorcycle =</span> DYCOL08,</a>
<a class="sourceLine" id="cb3-19" title="19">    <span class="dt">bicycle =</span> DYCOL09,</a>
<a class="sourceLine" id="cb3-20" title="20">    <span class="dt">radio =</span> DYCOL10,</a>
<a class="sourceLine" id="cb3-21" title="21">    <span class="dt">radiotape =</span> DYCOL11,</a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="dt">TVbw =</span> DYCOL12,</a>
<a class="sourceLine" id="cb3-23" title="23">    <span class="dt">TV =</span> DYCOL13,</a>
<a class="sourceLine" id="cb3-24" title="24">    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</a>
<a class="sourceLine" id="cb3-25" title="25">    <span class="dt">computer =</span> DYCOL15,</a>
<a class="sourceLine" id="cb3-26" title="26">    <span class="dt">cellphone =</span> DYCOL16,</a>
<a class="sourceLine" id="cb3-27" title="27">    <span class="dt">freezer =</span> DYCOL17,</a>
<a class="sourceLine" id="cb3-28" title="28">    <span class="dt">refridgerator =</span> DYCOL18,</a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="dt">fridge =</span> DYCOL19,</a>
<a class="sourceLine" id="cb3-30" title="30">    <span class="dt">stove =</span> DYCOL20,</a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="dt">vacuum =</span> DYCOL21,</a>
<a class="sourceLine" id="cb3-32" title="32">    <span class="dt">washingmachine =</span> DYCOL22,</a>
<a class="sourceLine" id="cb3-33" title="33">    <span class="dt">sewingmachine =</span> DYCOL23,</a>
<a class="sourceLine" id="cb3-34" title="34">    <span class="dt">fan =</span> DYCOL24,</a>
<a class="sourceLine" id="cb3-35" title="35">    <span class="dt">evapcoolingportable =</span> DYCOL25,</a>
<a class="sourceLine" id="cb3-36" title="36">    <span class="dt">splitportable =</span> DYCOL26,</a>
<a class="sourceLine" id="cb3-37" title="37">    <span class="dt">dishwasher =</span> DYCOL27,</a>
<a class="sourceLine" id="cb3-38" title="38">    <span class="dt">microwave =</span> DYCOL28,</a>
<a class="sourceLine" id="cb3-39" title="39">    <span class="dt">none =</span> DYCOL29,</a>
<a class="sourceLine" id="cb3-40" title="40">    <span class="dt">pipewater =</span> DYCOL30,</a>
<a class="sourceLine" id="cb3-41" title="41">    <span class="dt">electricity =</span> DYCOL31,</a>
<a class="sourceLine" id="cb3-42" title="42">    <span class="dt">pipegas =</span> DYCOL32,</a>
<a class="sourceLine" id="cb3-43" title="43">    <span class="dt">telephone =</span> DYCOL33,</a>
<a class="sourceLine" id="cb3-44" title="44">    <span class="dt">internet  =</span> DYCOL34,</a>
<a class="sourceLine" id="cb3-45" title="45">    <span class="dt">bathroom =</span> DYCOL35,</a>
<a class="sourceLine" id="cb3-46" title="46">    <span class="dt">kitchen =</span> DYCOL36,</a>
<a class="sourceLine" id="cb3-47" title="47">    <span class="dt">evapcooling =</span> DYCOL37,</a>
<a class="sourceLine" id="cb3-48" title="48">    <span class="dt">centralcooling =</span> DYCOL38,</a>
<a class="sourceLine" id="cb3-49" title="49">    <span class="dt">centralheating =</span> DYCOL39,</a>
<a class="sourceLine" id="cb3-50" title="50">    <span class="dt">package =</span> DYCOL40,</a>
<a class="sourceLine" id="cb3-51" title="51">    <span class="dt">split =</span> DYCOL41,</a>
<a class="sourceLine" id="cb3-52" title="52">    <span class="dt">wastewater =</span> DYCOL42,</a>
<a class="sourceLine" id="cb3-53" title="53">    <span class="dt">cookingfuel =</span> DYCOL43,</a>
<a class="sourceLine" id="cb3-54" title="54">    <span class="dt">heatingfuel =</span> DYCOL44,</a>
<a class="sourceLine" id="cb3-55" title="55">    <span class="dt">waterheatingfuel =</span> DYCOL45) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-56" title="56"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</a>
<a class="sourceLine" id="cb3-57" title="57">         <span class="kw">across</span>(<span class="kw">c</span>(tenure,material,cookingfuel,heatingfuel,waterheatingfuel), as.factor),</a>
<a class="sourceLine" id="cb3-58" title="58">         <span class="dt">tenure =</span> <span class="kw">fct_recode</span>(tenure, <span class="op">!!!</span>tenure), </a>
<a class="sourceLine" id="cb3-59" title="59">         <span class="dt">material =</span> <span class="kw">fct_recode</span>(material, <span class="op">!!!</span>material),</a>
<a class="sourceLine" id="cb3-60" title="60">         <span class="dt">cookingfuel =</span> <span class="kw">fct_recode</span>(cookingfuel, <span class="op">!!!</span>fuel), </a>
<a class="sourceLine" id="cb3-61" title="61">         <span class="dt">heatingfuel =</span> <span class="kw">fct_recode</span>(heatingfuel, <span class="op">!!!</span>fuel1),</a>
<a class="sourceLine" id="cb3-62" title="62">         <span class="dt">waterheatingfuel =</span> <span class="kw">fct_recode</span>(waterheatingfuel, <span class="op">!!!</span>fuel2),</a>
<a class="sourceLine" id="cb3-63" title="63">         <span class="kw">across</span>(vehicle<span class="op">:</span>wastewater, <span class="op">~!</span><span class="kw">is.na</span>(.x)))</a>
<a class="sourceLine" id="cb3-64" title="64">         </a>
<a class="sourceLine" id="cb3-65" title="65"></a>
<a class="sourceLine" id="cb3-66" title="66">U98P2 &lt;-<span class="st"> </span>U98P2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-67" title="67"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb3-68" title="68">    <span class="dt">tenure =</span> DYCOL01,</a>
<a class="sourceLine" id="cb3-69" title="69">    <span class="dt">room =</span> DYCOL03,</a>
<a class="sourceLine" id="cb3-70" title="70">    <span class="dt">space =</span> DYCOL04,</a>
<a class="sourceLine" id="cb3-71" title="71">    <span class="dt">construction =</span> DYCOL05,</a>
<a class="sourceLine" id="cb3-72" title="72">    <span class="dt">material =</span> DYCOL06,</a>
<a class="sourceLine" id="cb3-73" title="73">    <span class="dt">vehicle =</span> DYCOL07,</a>
<a class="sourceLine" id="cb3-74" title="74">    <span class="dt">motorcycle =</span> DYCOL08,</a>
<a class="sourceLine" id="cb3-75" title="75">    <span class="dt">bicycle =</span> DYCOL09,</a>
<a class="sourceLine" id="cb3-76" title="76">    <span class="dt">radio =</span> DYCOL10,</a>
<a class="sourceLine" id="cb3-77" title="77">    <span class="dt">radiotape =</span> DYCOL11,</a>
<a class="sourceLine" id="cb3-78" title="78">    <span class="dt">TVbw =</span> DYCOL12,</a>
<a class="sourceLine" id="cb3-79" title="79">    <span class="dt">TV =</span> DYCOL13,</a>
<a class="sourceLine" id="cb3-80" title="80">    <span class="dt">VHS_VCD_DVD =</span> DYCOL14,</a>
<a class="sourceLine" id="cb3-81" title="81">    <span class="dt">computer =</span> DYCOL15,</a>
<a class="sourceLine" id="cb3-82" title="82">    <span class="dt">cellphone =</span> DYCOL16,</a>
<a class="sourceLine" id="cb3-83" title="83">    <span class="dt">freezer =</span> DYCOL17,</a>
<a class="sourceLine" id="cb3-84" title="84">    <span class="dt">refridgerator =</span> DYCOL18,</a>
<a class="sourceLine" id="cb3-85" title="85">    <span class="dt">fridge =</span> DYCOL19,</a>
<a class="sourceLine" id="cb3-86" title="86">    <span class="dt">stove =</span> DYCOL20,</a>
<a class="sourceLine" id="cb3-87" title="87">    <span class="dt">vacuum =</span> DYCOL21,</a>
<a class="sourceLine" id="cb3-88" title="88">    <span class="dt">washingmachine =</span> DYCOL22,</a>
<a class="sourceLine" id="cb3-89" title="89">    <span class="dt">sewingmachine =</span> DYCOL23,</a>
<a class="sourceLine" id="cb3-90" title="90">    <span class="dt">fan =</span> DYCOL24,</a>
<a class="sourceLine" id="cb3-91" title="91">    <span class="dt">evapcoolingportable =</span> DYCOL25,</a>
<a class="sourceLine" id="cb3-92" title="92">    <span class="dt">splitportable =</span> DYCOL26,</a>
<a class="sourceLine" id="cb3-93" title="93">    <span class="dt">dishwasher =</span> DYCOL27,</a>
<a class="sourceLine" id="cb3-94" title="94">    <span class="dt">microwave =</span> DYCOL28,</a>
<a class="sourceLine" id="cb3-95" title="95">    <span class="dt">none =</span> DYCOL29,</a>
<a class="sourceLine" id="cb3-96" title="96">    <span class="dt">pipewater =</span> DYCOL30,</a>
<a class="sourceLine" id="cb3-97" title="97">    <span class="dt">electricity =</span> DYCOL31,</a>
<a class="sourceLine" id="cb3-98" title="98">    <span class="dt">pipegas =</span> DYCOL32,</a>
<a class="sourceLine" id="cb3-99" title="99">    <span class="dt">telephone =</span> DYCOL33,</a>
<a class="sourceLine" id="cb3-100" title="100">    <span class="dt">internet  =</span> DYCOL34,</a>
<a class="sourceLine" id="cb3-101" title="101">    <span class="dt">bathroom =</span> DYCOL35,</a>
<a class="sourceLine" id="cb3-102" title="102">    <span class="dt">kitchen =</span> DYCOL36,</a>
<a class="sourceLine" id="cb3-103" title="103">    <span class="dt">evapcooling =</span> DYCOL37,</a>
<a class="sourceLine" id="cb3-104" title="104">    <span class="dt">centralcooling =</span> DYCOL38,</a>
<a class="sourceLine" id="cb3-105" title="105">    <span class="dt">centralheating =</span> DYCOL39,</a>
<a class="sourceLine" id="cb3-106" title="106">    <span class="dt">package =</span> DYCOL40,</a>
<a class="sourceLine" id="cb3-107" title="107">    <span class="dt">split =</span> DYCOL41,</a>
<a class="sourceLine" id="cb3-108" title="108">    <span class="dt">wastewater =</span> DYCOL42,</a>
<a class="sourceLine" id="cb3-109" title="109">    <span class="dt">cookingfuel =</span> DYCOL43,</a>
<a class="sourceLine" id="cb3-110" title="110">    <span class="dt">heatingfuel =</span> DYCOL44,</a>
<a class="sourceLine" id="cb3-111" title="111">    <span class="dt">waterheatingfuel =</span> DYCOL45) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-112" title="112"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character), as.integer),</a>
<a class="sourceLine" id="cb3-113" title="113">         <span class="kw">across</span>(<span class="kw">c</span>(tenure,material,cookingfuel,heatingfuel,waterheatingfuel), as.factor),</a>
<a class="sourceLine" id="cb3-114" title="114">         <span class="dt">tenure =</span> <span class="kw">fct_recode</span>(tenure, <span class="op">!!!</span>tenure), </a>
<a class="sourceLine" id="cb3-115" title="115">         <span class="dt">material =</span> <span class="kw">fct_recode</span>(material, <span class="op">!!!</span>material),</a>
<a class="sourceLine" id="cb3-116" title="116">         <span class="dt">cookingfuel =</span> <span class="kw">fct_recode</span>(cookingfuel, <span class="op">!!!</span>fuel), </a>
<a class="sourceLine" id="cb3-117" title="117">         <span class="dt">heatingfuel =</span> <span class="kw">fct_recode</span>(heatingfuel, <span class="op">!!!</span>fuel1),</a>
<a class="sourceLine" id="cb3-118" title="118">         <span class="dt">waterheatingfuel =</span> <span class="kw">fct_recode</span>(waterheatingfuel, <span class="op">!!!</span>fuel2),</a>
<a class="sourceLine" id="cb3-119" title="119">         <span class="kw">across</span>(vehicle<span class="op">:</span>wastewater, <span class="op">~!</span><span class="kw">is.na</span>(.x)))</a></code></pre></div>
</div>
<div id="cleaning-part-3" class="section level2">
<h2><span class="header-section-number">4.4</span> Cleaning Part 3</h2>
<p>The most cumbersome step to clean HEIS is match expenditure items data overtime and adjust the value by price indices. We first rename all columns to have exactly the same name over different rounds of surveys and then define a unique code for each expenditure item. As expenditure categories are changing over time and in many cases a more general classification is deomposed into different categories, our global codes covers both general and detailed classifications. For example in one year there is an expenditure item ‘fruit’ and in the next year it is decomposed into ‘apple’, ‘banana’ and other fruits. We then would have 4 global codes: 1-fruit, 2-apple, 3-banana, 4-other fruits. Later we explain how the global codes are used for adjusting expenditure values by price index.</p>
<p><span style="color:red"> <strong>we should add here more details about expenditure code definition and how we match differet rounds of it with some examples perhaps</strong> </span></p>
<p>Here is a sample code for 1398 to rename variables and define unique item code as <em>DYCOL00</em>. Notice that the variables in all tables are not the same. The two variables “code” refering to item code in that year and “purchased” refers to method of obtaining exist in all tables. But many variables exist in only some tables like “gram”, “kilogram”, “price” in tables 1 and 2, “cost” and “sell” in table 13 and 14. In tables 1 to 12, “value” refers to value of transactions, but in tables 13 and 14 no such variable already exists and we define “value” as net expenditure (cost-sell).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Adding Global variable as DYCOL00</span></a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">##############################</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># Part 3, Table 1</span></a>
<a class="sourceLine" id="cb4-5" title="5">R98P3S01 &lt;-<span class="st"> </span>R98P3S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-12" title="12">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-14" title="14">    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</a>
<a class="sourceLine" id="cb4-15" title="15">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-16" title="16">    <span class="kw">across</span>(<span class="kw">c</span>(price,value,kilogram),  <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(.x)) ),</a>
<a class="sourceLine" id="cb4-17" title="17">    <span class="dt">table =</span> 1L)</a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19"></a>
<a class="sourceLine" id="cb4-20" title="20">U98P3S01 &lt;-<span class="st"> </span>U98P3S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-22" title="22">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-23" title="23">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-24" title="24">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-25" title="25">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-26" title="26">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-27" title="27">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-28" title="28"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-29" title="29">    code <span class="op">==</span><span class="st"> </span><span class="dv">11241</span> <span class="op">~</span><span class="st"> </span>11240L,</a>
<a class="sourceLine" id="cb4-30" title="30">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-31" title="31">    <span class="kw">across</span>(<span class="kw">c</span>(price,value,kilogram),  <span class="op">~</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(.x)) ),</a>
<a class="sourceLine" id="cb4-32" title="32">    <span class="dt">table =</span> 1L)</a>
<a class="sourceLine" id="cb4-33" title="33"></a>
<a class="sourceLine" id="cb4-34" title="34"><span class="co"># Part 3, Table 2</span></a>
<a class="sourceLine" id="cb4-35" title="35">R98P3S02 &lt;-<span class="st"> </span>R98P3S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-36" title="36"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-37" title="37">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-38" title="38">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-39" title="39">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-40" title="40">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-41" title="41">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-42" title="42">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-43" title="43"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-44" title="44">         <span class="dt">table =</span> 2L)</a>
<a class="sourceLine" id="cb4-45" title="45"></a>
<a class="sourceLine" id="cb4-46" title="46">U98P3S02 &lt;-<span class="st"> </span>U98P3S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-48" title="48">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-49" title="49">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-50" title="50">    <span class="dt">gram =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-51" title="51">    <span class="dt">kilogram =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-52" title="52">    <span class="dt">price =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-53" title="53">    <span class="dt">value =</span> DYCOL06 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-54" title="54"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-55" title="55">         <span class="dt">table =</span> 2L)</a>
<a class="sourceLine" id="cb4-56" title="56"></a>
<a class="sourceLine" id="cb4-57" title="57"><span class="co"># Part 3, Table 3</span></a>
<a class="sourceLine" id="cb4-58" title="58">R98P3S03 &lt;-<span class="st"> </span>R98P3S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-59" title="59"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-60" title="60">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-61" title="61">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-62" title="62">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-63" title="63"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-64" title="64">    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</a>
<a class="sourceLine" id="cb4-65" title="65">    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</a>
<a class="sourceLine" id="cb4-66" title="66">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-67" title="67">    <span class="dt">table =</span> 3L)</a>
<a class="sourceLine" id="cb4-68" title="68"></a>
<a class="sourceLine" id="cb4-69" title="69">U98P3S03 &lt;-<span class="st"> </span>U98P3S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-70" title="70"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-71" title="71">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-72" title="72">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-73" title="73">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-74" title="74"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-75" title="75">    code <span class="op">==</span><span class="st"> </span><span class="dv">31244</span> <span class="op">~</span><span class="st"> </span>31255L,</a>
<a class="sourceLine" id="cb4-76" title="76">    code <span class="op">==</span><span class="st"> </span><span class="dv">31269</span> <span class="op">~</span><span class="st"> </span>31263L,</a>
<a class="sourceLine" id="cb4-77" title="77">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-78" title="78">    <span class="dt">table =</span> 3L)</a>
<a class="sourceLine" id="cb4-79" title="79"></a>
<a class="sourceLine" id="cb4-80" title="80"><span class="co"># Part 3, Table 4</span></a>
<a class="sourceLine" id="cb4-81" title="81">R98P3S04 &lt;-<span class="st"> </span>R98P3S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-82" title="82"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-83" title="83">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-84" title="84">    <span class="dt">mortgage =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-85" title="85">    <span class="dt">purchased =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-86" title="86">    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-87" title="87"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-88" title="88">    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</a>
<a class="sourceLine" id="cb4-89" title="89">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-90" title="90">    <span class="dt">table =</span> 4L)</a>
<a class="sourceLine" id="cb4-91" title="91"></a>
<a class="sourceLine" id="cb4-92" title="92">U98P3S04 &lt;-<span class="st"> </span>U98P3S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-93" title="93"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-94" title="94">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-95" title="95">    <span class="dt">mortgage =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-96" title="96">    <span class="dt">purchased =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-97" title="97">    <span class="dt">value =</span> DYCOL04 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-98" title="98"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-99" title="99">    code <span class="op">==</span><span class="st"> </span><span class="dv">44418</span> <span class="op">~</span><span class="st"> </span>44419L,</a>
<a class="sourceLine" id="cb4-100" title="100">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-101" title="101">    <span class="dt">table =</span> 4L)</a>
<a class="sourceLine" id="cb4-102" title="102"></a>
<a class="sourceLine" id="cb4-103" title="103"><span class="co"># Part 3, Table 5</span></a>
<a class="sourceLine" id="cb4-104" title="104">R98P3S05 &lt;-<span class="st"> </span>R98P3S05 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-105" title="105"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-106" title="106">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-107" title="107">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-108" title="108">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-109" title="109"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-110" title="110">         <span class="dt">table =</span> 5L)</a>
<a class="sourceLine" id="cb4-111" title="111"></a>
<a class="sourceLine" id="cb4-112" title="112">U98P3S05 &lt;-<span class="st"> </span>U98P3S05 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-113" title="113"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-114" title="114">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-115" title="115">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-116" title="116">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-117" title="117"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-118" title="118">         <span class="dt">table =</span> 5L)</a>
<a class="sourceLine" id="cb4-119" title="119"></a>
<a class="sourceLine" id="cb4-120" title="120"></a>
<a class="sourceLine" id="cb4-121" title="121"><span class="co"># Part 3, Table 6</span></a>
<a class="sourceLine" id="cb4-122" title="122">R98P3S06 &lt;-<span class="st"> </span>R98P3S06  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-123" title="123"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-124" title="124">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-125" title="125">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-126" title="126">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-127" title="127"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-128" title="128">    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</a>
<a class="sourceLine" id="cb4-129" title="129">    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</a>
<a class="sourceLine" id="cb4-130" title="130">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-131" title="131">    <span class="dt">table =</span> 6L)</a>
<a class="sourceLine" id="cb4-132" title="132"></a>
<a class="sourceLine" id="cb4-133" title="133">U98P3S06 &lt;-<span class="st"> </span>U98P3S06 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-134" title="134"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-135" title="135">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-136" title="136">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-137" title="137">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-138" title="138"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-139" title="139">    code <span class="op">==</span><span class="st"> </span><span class="dv">62128</span> <span class="op">~</span><span class="st"> </span>62125L,</a>
<a class="sourceLine" id="cb4-140" title="140">    code <span class="op">==</span><span class="st"> </span><span class="dv">62129</span> <span class="op">~</span><span class="st"> </span>62126L,</a>
<a class="sourceLine" id="cb4-141" title="141">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-142" title="142">    <span class="dt">table =</span> 6L)</a>
<a class="sourceLine" id="cb4-143" title="143"></a>
<a class="sourceLine" id="cb4-144" title="144"><span class="co"># Part 3, Table 7</span></a>
<a class="sourceLine" id="cb4-145" title="145">R98P3S07 &lt;-<span class="st"> </span>R98P3S07 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-146" title="146"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-147" title="147">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-148" title="148">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-149" title="149">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-150" title="150"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-151" title="151">    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</a>
<a class="sourceLine" id="cb4-152" title="152">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-153" title="153">    <span class="dt">table =</span> 7L)</a>
<a class="sourceLine" id="cb4-154" title="154"></a>
<a class="sourceLine" id="cb4-155" title="155">U98P3S07 &lt;-<span class="st"> </span>U98P3S07 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-156" title="156"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-157" title="157">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-158" title="158">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-159" title="159">    <span class="dt">value =</span> DYCOL03 ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-160" title="160"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-161" title="161">    code <span class="op">==</span><span class="st"> </span><span class="dv">73611</span> <span class="op">~</span><span class="st"> </span>73615L,</a>
<a class="sourceLine" id="cb4-162" title="162">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-163" title="163">    <span class="dt">table =</span> 7L)</a>
<a class="sourceLine" id="cb4-164" title="164"></a>
<a class="sourceLine" id="cb4-165" title="165"><span class="co"># Part 3, Table 8</span></a>
<a class="sourceLine" id="cb4-166" title="166">R98P3S08 &lt;-<span class="st"> </span>R98P3S08 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-167" title="167"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-168" title="168">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-169" title="169">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-170" title="170">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-171" title="171"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-172" title="172">         <span class="dt">table =</span> 8L)</a>
<a class="sourceLine" id="cb4-173" title="173"></a>
<a class="sourceLine" id="cb4-174" title="174">U98P3S08 &lt;-<span class="st"> </span>U98P3S08 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-175" title="175"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-176" title="176">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-177" title="177">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-178" title="178">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-179" title="179"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-180" title="180">         <span class="dt">table =</span> 8L)</a>
<a class="sourceLine" id="cb4-181" title="181"></a>
<a class="sourceLine" id="cb4-182" title="182"><span class="co"># Part 3, Table 9</span></a>
<a class="sourceLine" id="cb4-183" title="183">R98P3S09 &lt;-<span class="st"> </span>R98P3S09 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-184" title="184"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-185" title="185">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-186" title="186">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-187" title="187">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-188" title="188"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-189" title="189">         <span class="dt">table =</span> 9L)</a>
<a class="sourceLine" id="cb4-190" title="190"></a>
<a class="sourceLine" id="cb4-191" title="191">U98P3S09 &lt;-<span class="st"> </span>U98P3S09 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-192" title="192"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-193" title="193">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-194" title="194">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-195" title="195">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-196" title="196"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-197" title="197">         <span class="dt">table =</span> 9L)</a>
<a class="sourceLine" id="cb4-198" title="198"></a>
<a class="sourceLine" id="cb4-199" title="199"><span class="co"># Part 3, Table 10</span></a>
<a class="sourceLine" id="cb4-200" title="200">R98P3S10 &lt;-<span class="st"> </span>R98P3S10 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-201" title="201"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-202" title="202">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-203" title="203">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-204" title="204">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-205" title="205"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-206" title="206">         <span class="dt">table =</span> 10L)</a>
<a class="sourceLine" id="cb4-207" title="207"></a>
<a class="sourceLine" id="cb4-208" title="208">U98P3S10 &lt;-<span class="st"> </span>U98P3S10 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-209" title="209"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-210" title="210">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-211" title="211">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-212" title="212">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-213" title="213"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-214" title="214">         <span class="dt">table =</span> 10L)</a>
<a class="sourceLine" id="cb4-215" title="215"></a>
<a class="sourceLine" id="cb4-216" title="216"><span class="co"># Part 3, Table 11</span></a>
<a class="sourceLine" id="cb4-217" title="217"></a>
<a class="sourceLine" id="cb4-218" title="218">R98P3S11 &lt;-<span class="st"> </span>R98P3S11 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-219" title="219"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-220" title="220">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-221" title="221">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-222" title="222">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-223" title="223"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-224" title="224">         <span class="dt">table =</span> 11L)</a>
<a class="sourceLine" id="cb4-225" title="225"></a>
<a class="sourceLine" id="cb4-226" title="226">U98P3S11 &lt;-<span class="st"> </span>U98P3S11 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-227" title="227"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-228" title="228">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-229" title="229">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-230" title="230">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-231" title="231"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-232" title="232">         <span class="dt">table =</span> 11L)</a>
<a class="sourceLine" id="cb4-233" title="233"></a>
<a class="sourceLine" id="cb4-234" title="234"><span class="co"># Part 3, Table 12</span></a>
<a class="sourceLine" id="cb4-235" title="235">R98P3S12 &lt;-<span class="st"> </span>R98P3S12 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-236" title="236"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-237" title="237">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-238" title="238">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-239" title="239">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-240" title="240"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-241" title="241">         <span class="dt">table =</span> 12L)</a>
<a class="sourceLine" id="cb4-242" title="242"></a>
<a class="sourceLine" id="cb4-243" title="243">U98P3S12 &lt;-<span class="st"> </span>U98P3S12 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-244" title="244"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-245" title="245">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-246" title="246">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-247" title="247">    <span class="dt">value =</span> DYCOL03) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-248" title="248"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-249" title="249">         <span class="dt">table =</span> 12L)</a>
<a class="sourceLine" id="cb4-250" title="250"></a>
<a class="sourceLine" id="cb4-251" title="251"></a>
<a class="sourceLine" id="cb4-252" title="252"><span class="co"># Part 3, Table 13</span></a>
<a class="sourceLine" id="cb4-253" title="253">R98P3S13 &lt;-<span class="st"> </span>R98P3S13 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-254" title="254"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-255" title="255">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-256" title="256">    <span class="dt">insured_loan =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-257" title="257">    <span class="dt">loanfrom =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-258" title="258">    <span class="dt">purchased =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-259" title="259">    <span class="dt">cost =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-260" title="260">    <span class="dt">sell =</span> DYCOL06) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-261" title="261"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-262" title="262">    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</a>
<a class="sourceLine" id="cb4-263" title="263">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-264" title="264">    <span class="dt">table =</span> 13L,</a>
<a class="sourceLine" id="cb4-265" title="265">    <span class="dt">cost =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(cost),<span class="dv">0</span>,cost),</a>
<a class="sourceLine" id="cb4-266" title="266">    <span class="dt">sell =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(sell),<span class="dv">0</span>,sell),</a>
<a class="sourceLine" id="cb4-267" title="267">    <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell)</a>
<a class="sourceLine" id="cb4-268" title="268"></a>
<a class="sourceLine" id="cb4-269" title="269">U98P3S13 &lt;-<span class="st"> </span>U98P3S13 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-270" title="270"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-271" title="271">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-272" title="272">    <span class="dt">insured_loan =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-273" title="273">    <span class="dt">loanfrom =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-274" title="274">    <span class="dt">purchased =</span> DYCOL04,</a>
<a class="sourceLine" id="cb4-275" title="275">    <span class="dt">cost =</span> DYCOL05,</a>
<a class="sourceLine" id="cb4-276" title="276">    <span class="dt">sell =</span> DYCOL06) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-277" title="277"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb4-278" title="278">    code <span class="op">==</span><span class="st"> </span><span class="dv">51161</span> <span class="op">~</span><span class="st"> </span>51160L,</a>
<a class="sourceLine" id="cb4-279" title="279">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>code),</a>
<a class="sourceLine" id="cb4-280" title="280">    <span class="dt">table =</span> 13L,</a>
<a class="sourceLine" id="cb4-281" title="281">    <span class="dt">cost =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(cost),<span class="dv">0</span>,cost),</a>
<a class="sourceLine" id="cb4-282" title="282">    <span class="dt">sell =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(sell),<span class="dv">0</span>,sell),</a>
<a class="sourceLine" id="cb4-283" title="283">    <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell)</a>
<a class="sourceLine" id="cb4-284" title="284"></a>
<a class="sourceLine" id="cb4-285" title="285"><span class="co"># Part 3, Table 14</span></a>
<a class="sourceLine" id="cb4-286" title="286">R98P3S14 &lt;-<span class="st"> </span>R98P3S14 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-287" title="287"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-288" title="288">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-289" title="289">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-290" title="290">    <span class="dt">cost =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-291" title="291">    <span class="dt">sell =</span> DYCOL04) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-292" title="292"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-293" title="293">         <span class="dt">table =</span> 14L,</a>
<a class="sourceLine" id="cb4-294" title="294">         <span class="dt">cost =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(cost),<span class="dv">0</span>,cost),</a>
<a class="sourceLine" id="cb4-295" title="295">         <span class="dt">sell =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(sell),<span class="dv">0</span>,sell),</a>
<a class="sourceLine" id="cb4-296" title="296">         <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell)</a>
<a class="sourceLine" id="cb4-297" title="297"></a>
<a class="sourceLine" id="cb4-298" title="298">U98P3S14 &lt;-<span class="st"> </span>U98P3S14 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-299" title="299"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb4-300" title="300">    <span class="dt">code =</span> DYCOL01,</a>
<a class="sourceLine" id="cb4-301" title="301">    <span class="dt">purchased =</span> DYCOL02,</a>
<a class="sourceLine" id="cb4-302" title="302">    <span class="dt">cost =</span> DYCOL03,</a>
<a class="sourceLine" id="cb4-303" title="303">    <span class="dt">sell =</span> DYCOL04) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-304" title="304"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DYCOL00 =</span> code,</a>
<a class="sourceLine" id="cb4-305" title="305">         <span class="dt">table =</span> 14L,</a>
<a class="sourceLine" id="cb4-306" title="306">         <span class="dt">cost =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(cost),<span class="dv">0</span>,cost),</a>
<a class="sourceLine" id="cb4-307" title="307">         <span class="dt">sell =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(sell),<span class="dv">0</span>,sell),</a>
<a class="sourceLine" id="cb4-308" title="308">         <span class="dt">value =</span> cost <span class="op">-</span><span class="st"> </span>sell)</a></code></pre></div>
</div>
<div id="cleaning-part-4" class="section level2">
<h2><span class="header-section-number">4.5</span> Cleaning Part 4</h2>
<p>For income tables we first rename the variables in each year to get unique names. We then remove unnecessary objects and save the image of all dataframes with harmonized names and codes as <em>HEIS98.Rdata</em>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="co">##############################</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># Part 4, Table 1</span></a>
<a class="sourceLine" id="cb5-3" title="3">R98P4S01 &lt;-<span class="st"> </span>R98P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">employed_w =</span> DYCOL02,</a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="dt">ISCO_w =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="dt">ISIC_w =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="dt">status_w =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-10" title="10">    <span class="dt">hours_w =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="dt">days_w =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="dt">income_w_m =</span> DYCOL08,</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="dt">income_w_y =</span> DYCOL09,</a>
<a class="sourceLine" id="cb5-14" title="14">    <span class="dt">wage_w_m =</span> DYCOL10,</a>
<a class="sourceLine" id="cb5-15" title="15">    <span class="dt">wage_w_y =</span> DYCOL11,</a>
<a class="sourceLine" id="cb5-16" title="16">    <span class="dt">perk_w_m =</span> DYCOL12,</a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="dt">perk_w_y =</span> DYCOL13,</a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="dt">netincome_w_m =</span> DYCOL14,</a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="dt">netincome_w_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb5-20" title="20"></a>
<a class="sourceLine" id="cb5-21" title="21">U98P4S01 &lt;-<span class="st"> </span>U98P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-23" title="23">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-24" title="24">    <span class="dt">employed_w =</span> DYCOL02,</a>
<a class="sourceLine" id="cb5-25" title="25">    <span class="dt">ISCO_w =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-26" title="26">    <span class="dt">ISIC_w =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-27" title="27">    <span class="dt">status_w =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-28" title="28">    <span class="dt">hours_w =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-29" title="29">    <span class="dt">days_w =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-30" title="30">    <span class="dt">income_w_m =</span> DYCOL08,</a>
<a class="sourceLine" id="cb5-31" title="31">    <span class="dt">income_w_y =</span> DYCOL09,</a>
<a class="sourceLine" id="cb5-32" title="32">    <span class="dt">wage_w_m =</span> DYCOL10,</a>
<a class="sourceLine" id="cb5-33" title="33">    <span class="dt">wage_w_y =</span> DYCOL11,</a>
<a class="sourceLine" id="cb5-34" title="34">    <span class="dt">perk_w_m =</span> DYCOL12,</a>
<a class="sourceLine" id="cb5-35" title="35">    <span class="dt">perk_w_y =</span> DYCOL13,</a>
<a class="sourceLine" id="cb5-36" title="36">    <span class="dt">netincome_w_m =</span> DYCOL14,</a>
<a class="sourceLine" id="cb5-37" title="37">    <span class="dt">netincome_w_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb5-38" title="38"></a>
<a class="sourceLine" id="cb5-39" title="39"><span class="co"># Part 4, Table 2</span></a>
<a class="sourceLine" id="cb5-40" title="40">R98P4S02 &lt;-<span class="st"> </span>R98P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-41" title="41"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-42" title="42">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-43" title="43">    <span class="dt">employed_s =</span> DYCOL02,</a>
<a class="sourceLine" id="cb5-44" title="44">    <span class="dt">ISCO_s =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-45" title="45">    <span class="dt">ISIC_s =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-46" title="46">    <span class="dt">status_s =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-47" title="47">    <span class="dt">agriculture =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-48" title="48">    <span class="dt">hours_s =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-49" title="49">    <span class="dt">days_s =</span> DYCOL08,</a>
<a class="sourceLine" id="cb5-50" title="50">    <span class="dt">cost_employment =</span> DYCOL09,</a>
<a class="sourceLine" id="cb5-51" title="51">    <span class="dt">cost_raw =</span> DYCOL10,</a>
<a class="sourceLine" id="cb5-52" title="52">    <span class="dt">cost_machinery =</span> DYCOL11,</a>
<a class="sourceLine" id="cb5-53" title="53">    <span class="dt">cost_others =</span> DYCOL12,</a>
<a class="sourceLine" id="cb5-54" title="54">    <span class="dt">cost_tax =</span> DYCOL13,</a>
<a class="sourceLine" id="cb5-55" title="55">    <span class="dt">sale =</span> DYCOL14,</a>
<a class="sourceLine" id="cb5-56" title="56">    <span class="dt">income_s_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb5-57" title="57"></a>
<a class="sourceLine" id="cb5-58" title="58">U98P4S02 &lt;-<span class="st"> </span>U98P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-59" title="59"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-60" title="60">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-61" title="61">    <span class="dt">employed_s =</span> DYCOL02,</a>
<a class="sourceLine" id="cb5-62" title="62">    <span class="dt">ISCO_s =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-63" title="63">    <span class="dt">ISIC_s =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-64" title="64">    <span class="dt">status_s =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-65" title="65">    <span class="dt">agriculture =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-66" title="66">    <span class="dt">hours_s =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-67" title="67">    <span class="dt">days_s =</span> DYCOL08,</a>
<a class="sourceLine" id="cb5-68" title="68">    <span class="dt">cost_employment =</span> DYCOL09,</a>
<a class="sourceLine" id="cb5-69" title="69">    <span class="dt">cost_raw =</span> DYCOL10,</a>
<a class="sourceLine" id="cb5-70" title="70">    <span class="dt">cost_machinery =</span> DYCOL11,</a>
<a class="sourceLine" id="cb5-71" title="71">    <span class="dt">cost_others =</span> DYCOL12,</a>
<a class="sourceLine" id="cb5-72" title="72">    <span class="dt">cost_tax =</span> DYCOL13,</a>
<a class="sourceLine" id="cb5-73" title="73">    <span class="dt">sale =</span> DYCOL14,</a>
<a class="sourceLine" id="cb5-74" title="74">    <span class="dt">income_s_y =</span> DYCOL15)</a>
<a class="sourceLine" id="cb5-75" title="75"></a>
<a class="sourceLine" id="cb5-76" title="76"><span class="co"># Part 4, Table 3</span></a>
<a class="sourceLine" id="cb5-77" title="77">R98P4S03 &lt;-<span class="st"> </span>R98P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-78" title="78"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-79" title="79">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-80" title="80">    <span class="dt">income_pension =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-81" title="81">    <span class="dt">income_rent =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-82" title="82">    <span class="dt">income_interest =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-83" title="83">    <span class="dt">income_aid =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-84" title="84">    <span class="dt">income_resale =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-85" title="85">    <span class="dt">income_transfer =</span> DYCOL08)</a>
<a class="sourceLine" id="cb5-86" title="86"></a>
<a class="sourceLine" id="cb5-87" title="87">U98P4S03 &lt;-<span class="st"> </span>U98P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-88" title="88"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-89" title="89">    <span class="dt">member =</span> DYCOL01,</a>
<a class="sourceLine" id="cb5-90" title="90">    <span class="dt">income_pension =</span> DYCOL03,</a>
<a class="sourceLine" id="cb5-91" title="91">    <span class="dt">income_rent =</span> DYCOL04,</a>
<a class="sourceLine" id="cb5-92" title="92">    <span class="dt">income_interest =</span> DYCOL05,</a>
<a class="sourceLine" id="cb5-93" title="93">    <span class="dt">income_aid =</span> DYCOL06,</a>
<a class="sourceLine" id="cb5-94" title="94">    <span class="dt">income_resale =</span> DYCOL07,</a>
<a class="sourceLine" id="cb5-95" title="95">    <span class="dt">income_transfer =</span> DYCOL08)</a>
<a class="sourceLine" id="cb5-96" title="96"></a>
<a class="sourceLine" id="cb5-97" title="97"><span class="co"># Part 4, Table 4</span></a>
<a class="sourceLine" id="cb5-98" title="98"></a>
<a class="sourceLine" id="cb5-99" title="99">R98P4S04 &lt;-<span class="st"> </span>R98P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-100" title="100"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-101" title="101">    <span class="dt">member =</span> Dycol01,</a>
<a class="sourceLine" id="cb5-102" title="102">    <span class="dt">subsidy_number =</span> Dycol03,</a>
<a class="sourceLine" id="cb5-103" title="103">    <span class="dt">subsidy_month =</span> Dycol04,</a>
<a class="sourceLine" id="cb5-104" title="104">    <span class="dt">subsidy =</span> Dycol05)</a>
<a class="sourceLine" id="cb5-105" title="105"></a>
<a class="sourceLine" id="cb5-106" title="106">U98P4S04 &lt;-<span class="st"> </span>U98P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-107" title="107"><span class="st">  </span><span class="kw">rename</span>(</a>
<a class="sourceLine" id="cb5-108" title="108">    <span class="dt">member =</span> Dycol01,</a>
<a class="sourceLine" id="cb5-109" title="109">    <span class="dt">subsidy_number =</span> Dycol03,</a>
<a class="sourceLine" id="cb5-110" title="110">    <span class="dt">subsidy_month =</span> Dycol04,</a>
<a class="sourceLine" id="cb5-111" title="111">    <span class="dt">subsidy =</span> Dycol05)</a>
<a class="sourceLine" id="cb5-112" title="112"></a>
<a class="sourceLine" id="cb5-113" title="113"><span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">setdiff</span>(<span class="kw">ls</span>(), <span class="kw">ls</span>(<span class="dt">pattern =</span> <span class="st">&quot;98&quot;</span>))) <span class="co"># removing unnecessary objects</span></a>
<a class="sourceLine" id="cb5-114" title="114"></a>
<a class="sourceLine" id="cb5-115" title="115"><span class="kw">save.image</span>(<span class="dt">file=</span><span class="st">&quot;./exported/HEIS98.Rdata&quot;</span>)</a></code></pre></div>
</div>
<div id="builiding-item-level-data" class="section level2">
<h2><span class="header-section-number">4.6</span> Builiding item level data</h2>
<p>Next, we merge all tables in Part 3 for getting a unique expenditure table by item for rural and urban regions. This table helps to document the trend of expenditure in different item when we will match different years with price index.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">###############################################</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co"># Item-level expenditure table</span></a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4">R98P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R98P3S01, R98P3S02, R98P3S03, R98P3S04, R98P3S05, R98P3S06, R98P3S07, R98P3S08, R98P3S09, R98P3S11, R98P3S12, R98P3S13, R98P3S14)</a>
<a class="sourceLine" id="cb6-5" title="5">R98P3 &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st">  </span><span class="kw">left_join</span>(R98Data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb6-8" title="8">         <span class="dt">town =</span> <span class="kw">substr</span>(Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb6-9" title="9">         <span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>)</a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11">U98P3 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(U98P3S01, U98P3S02, U98P3S03, U98P3S04, U98P3S05, U98P3S06, U98P3S07, U98P3S08, U98P3S09, U98P3S11, U98P3S12, U98P3S13, U98P3S14)</a>
<a class="sourceLine" id="cb6-12" title="12">U98P3 &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="st">  </span><span class="kw">left_join</span>(U98Data) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">province =</span> <span class="kw">substr</span>(U98P3<span class="op">$</span>Address, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb6-15" title="15">         <span class="dt">town =</span> <span class="kw">substr</span>(U98P3<span class="op">$</span>Address, <span class="dv">4</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb6-16" title="16">         <span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>)</a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">EXP98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(R98P3,U98P3) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">gcode =</span> DYCOL00) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="st">  </span><span class="kw">group_by</span>(table, gcode, code, urban) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-22" title="22"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Value =</span> <span class="kw">sum</span>(value<span class="op">*</span>weight, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb6-23" title="23">            <span class="dt">Kilogram =</span> <span class="kw">sum</span>(kilogram<span class="op">*</span>weight, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb6-24" title="24">            <span class="dt">Gram =</span> <span class="kw">sum</span>(gram<span class="op">*</span>weight, <span class="dt">na.rm =</span> T),</a>
<a class="sourceLine" id="cb6-25" title="25">            <span class="dt">Price =</span> <span class="kw">median</span>(price, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-26" title="26"><span class="st">  </span><span class="kw">filter</span>(Value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb6-28" title="28"></a>
<a class="sourceLine" id="cb6-29" title="29"><span class="kw">attr</span>(EXP98<span class="op">$</span>table, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;table number in Part 3&quot;</span></a>
<a class="sourceLine" id="cb6-30" title="30"><span class="kw">attr</span>(EXP98<span class="op">$</span>gcode, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;global item code&quot;</span></a>
<a class="sourceLine" id="cb6-31" title="31"><span class="kw">attr</span>(EXP98<span class="op">$</span>code, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;item code in this year&quot;</span></a>
<a class="sourceLine" id="cb6-32" title="32"><span class="kw">attr</span>(EXP98<span class="op">$</span>urban, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;rural or urban&quot;</span></a>
<a class="sourceLine" id="cb6-33" title="33"><span class="kw">attr</span>(EXP98<span class="op">$</span>Price, <span class="st">&quot;label&quot;</span>) &lt;-<span class="st"> &quot;median price&quot;</span></a>
<a class="sourceLine" id="cb6-34" title="34"></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="kw">saveRDS</span>(EXP98, <span class="st">&quot;./exported/EXP98.Rds&quot;</span>)</a></code></pre></div>
</div>
<div id="building-individual-level-data" class="section level2">
<h2><span class="header-section-number">4.7</span> Building individual-level data</h2>
<p>As part 1 and part 4 are at individual level, we merge them to make unique dataframe containing individual characteristics and income. Later we merge this dataframes over differet survey years by adjusting for prices. It can then be also used as a rotating panel data for 1389 onwards. One issue to build individual-level data is multi-job people that have more than one occupation code and wage. For this reason, we unify individuals by summing up their income items over different jobs in each table and counting the first listed job as their industry and occupation code. The dataframe ending with "_unique" in the below code are the unified version of 4 tables of Part 4.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co">###############################################</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># Building individual level data</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">r98data&lt;-<span class="st"> </span>R98Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, mah, weight, khanevartype, Jaygozin, province)</a>
<a class="sourceLine" id="cb7-5" title="5">u98data&lt;-<span class="st"> </span>U98Data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Address, mah, weight, khanevartype, Jaygozin, province)</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co"># Multi-job people are repeated and need to be unified. The below code is using dplyr</span></a>
<a class="sourceLine" id="cb7-9" title="9">R98P4S01_unique &lt;-<span class="st"> </span>R98P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_w,ISCO_w,ISIC_w,status_w), first),</a>
<a class="sourceLine" id="cb7-12" title="12">            <span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w,<span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;_y&quot;</span>,<span class="st">&quot;_m&quot;</span>))), <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16"></a>
<a class="sourceLine" id="cb7-17" title="17">R98P4S02_unique &lt;-<span class="st"> </span>R98P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_s,ISCO_s,ISIC_s,status_s, agriculture), first),</a>
<a class="sourceLine" id="cb7-20" title="20">            <span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s,<span class="kw">starts_with</span>(<span class="st">&quot;cost_&quot;</span>),sale ,income_s_y),</a>
<a class="sourceLine" id="cb7-21" title="21">                   <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</a>
<a class="sourceLine" id="cb7-24" title="24"></a>
<a class="sourceLine" id="cb7-25" title="25">R98P4S03_unique &lt;-<span class="st"> </span>R98P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;income_&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a>
<a class="sourceLine" id="cb7-28" title="28"></a>
<a class="sourceLine" id="cb7-29" title="29">R98P4S04_unique &lt;-<span class="st"> </span>R98P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;subsidy&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a>
<a class="sourceLine" id="cb7-32" title="32"></a>
<a class="sourceLine" id="cb7-33" title="33">Rind98 &lt;-<span class="st"> </span>r98data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="st">  </span><span class="kw">left_join</span>(R98P1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="st">  </span><span class="kw">left_join</span>(R98P4S01_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-37" title="37"><span class="st">  </span><span class="kw">left_join</span>(R98P4S02_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-38" title="38"><span class="st">  </span><span class="kw">left_join</span>(R98P4S03_unique) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-39" title="39"><span class="st">  </span><span class="kw">left_join</span>(R98P4S04_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-40" title="40"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character),as.integer)) </a>
<a class="sourceLine" id="cb7-41" title="41"></a>
<a class="sourceLine" id="cb7-42" title="42">U98P4S01_unique &lt;-<span class="st"> </span>U98P4S01 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-43" title="43"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_w,ISCO_w,ISIC_w,status_w), first),</a>
<a class="sourceLine" id="cb7-45" title="45">            <span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w,<span class="kw">ends_with</span>(<span class="kw">c</span>(<span class="st">&quot;_y&quot;</span>,<span class="st">&quot;_m&quot;</span>))), <span class="op">~</span><span class="st"> </span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_w,days_w), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</a>
<a class="sourceLine" id="cb7-48" title="48"></a>
<a class="sourceLine" id="cb7-49" title="49">U98P4S02_unique &lt;-<span class="st"> </span>U98P4S02 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-51" title="51"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">c</span>(employed_s,ISCO_s,ISIC_s,status_s, agriculture), first),</a>
<a class="sourceLine" id="cb7-52" title="52">            <span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s,<span class="kw">starts_with</span>(<span class="st">&quot;cost_&quot;</span>),sale, income_s_y),</a>
<a class="sourceLine" id="cb7-53" title="53">                   <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-54" title="54"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-55" title="55"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(hours_s,days_s), <span class="op">~</span><span class="kw">ifelse</span>(.x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="ot">NA</span>,.x)))</a>
<a class="sourceLine" id="cb7-56" title="56"></a>
<a class="sourceLine" id="cb7-57" title="57">U98P4S03_unique &lt;-<span class="st"> </span>U98P4S03 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-58" title="58"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-59" title="59"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;income_&quot;</span>),<span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a>
<a class="sourceLine" id="cb7-60" title="60"></a>
<a class="sourceLine" id="cb7-61" title="61">U98P4S04_unique &lt;-<span class="st"> </span>U98P4S04 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-62" title="62"><span class="st">  </span><span class="kw">group_by</span>(Address, member) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-63" title="63"><span class="st">  </span><span class="kw">summarize</span>(<span class="kw">across</span>(<span class="kw">starts_with</span>(<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a>
<a class="sourceLine" id="cb7-64" title="64"></a>
<a class="sourceLine" id="cb7-65" title="65">Uind98 &lt;-<span class="st"> </span>u98data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-66" title="66"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-67" title="67"><span class="st">  </span><span class="kw">left_join</span>(U98P1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-68" title="68"><span class="st">  </span><span class="kw">left_join</span>(U98P4S01_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-69" title="69"><span class="st">  </span><span class="kw">left_join</span>(U98P4S02_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-70" title="70"><span class="st">  </span><span class="kw">left_join</span>(U98P4S03_unique) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-71" title="71"><span class="st">  </span><span class="kw">left_join</span>(U98P4S04_unique) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-72" title="72"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.character),as.integer))</a>
<a class="sourceLine" id="cb7-73" title="73"></a>
<a class="sourceLine" id="cb7-74" title="74">IND98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(Rind98,Uind98) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-75" title="75"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-76" title="76"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb7-77" title="77"></a>
<a class="sourceLine" id="cb7-78" title="78"><span class="kw">saveRDS</span>(IND98,<span class="st">&quot;./exported/IND98.Rds&quot;</span>)</a></code></pre></div>
</div>
<div id="building-household-level-data-summary-files" class="section level2">
<h2><span class="header-section-number">4.8</span> Building Household-level data (summary files)</h2>
<p>Together with the raw data, SCI also disseminates the summary files for each HEIS year which includes household level summary data of the survey. With the same idea we build summary files for each year as follows.</p>
<p>For doing this, we first build dataframes with household size,the number of literate, student, and employed members, and the characteristics of the head of household.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">###############################################</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co"># Building Household Data</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co"># Household size, number of literates, students, employeds</span></a>
<a class="sourceLine" id="cb8-5" title="5">r98p1 &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">size =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(member)),</a>
<a class="sourceLine" id="cb8-8" title="8">         <span class="dt">literates =</span> <span class="kw">sum</span>(literacy <span class="op">==</span><span class="st"> &quot;literate&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb8-9" title="9">         <span class="dt">students =</span> <span class="kw">sum</span>(studying <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb8-10" title="10">         <span class="dt">employeds =</span> <span class="kw">sum</span>(occupationalst <span class="op">==</span><span class="st"> &quot;employed&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12">u98p1 &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">size =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(member)),</a>
<a class="sourceLine" id="cb8-15" title="15">            <span class="dt">literates =</span> <span class="kw">sum</span>(literacy <span class="op">==</span><span class="st"> &quot;literate&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb8-16" title="16">            <span class="dt">students =</span> <span class="kw">sum</span>(studying <span class="op">==</span><span class="st"> &quot;Yes&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb8-17" title="17">            <span class="dt">employeds =</span> <span class="kw">sum</span>(occupationalst <span class="op">==</span><span class="st"> &quot;employed&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb8-18" title="18"></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co"># Head&#39;s characteristics in Part 1</span></a>
<a class="sourceLine" id="cb8-20" title="20">r_head &lt;-<span class="st"> </span>R98P1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-22" title="22"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>member,<span class="op">-</span>relation,<span class="op">-</span>studying)</a>
<a class="sourceLine" id="cb8-23" title="23"></a>
<a class="sourceLine" id="cb8-24" title="24">u_head &lt;-<span class="st"> </span>U98P1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-25" title="25"><span class="st">        </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-26" title="26"><span class="st">        </span><span class="kw">select</span>(<span class="op">-</span>member,<span class="op">-</span>relation,<span class="op">-</span>studying)</a>
<a class="sourceLine" id="cb8-27" title="27"></a>
<a class="sourceLine" id="cb8-28" title="28"><span class="co"># summary of heads job codes</span></a>
<a class="sourceLine" id="cb8-29" title="29">r_job &lt;-<span class="st"> </span>Rind98 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-30" title="30"><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-31" title="31"><span class="st">  </span><span class="kw">select</span>(Address,<span class="kw">starts_with</span>(<span class="st">&quot;IS&quot;</span>))</a>
<a class="sourceLine" id="cb8-32" title="32"></a>
<a class="sourceLine" id="cb8-33" title="33">u_job &lt;-<span class="st"> </span>Uind98 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-34" title="34"><span class="st">  </span><span class="kw">filter</span>(relation <span class="op">==</span><span class="st"> &quot;Head&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-35" title="35"><span class="st">  </span><span class="kw">select</span>(Address,<span class="kw">starts_with</span>(<span class="st">&quot;IS&quot;</span>))</a></code></pre></div>
<p>We next summarize household expenditure items within each table of Part 3:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Sum of household expenditure items</span></a>
<a class="sourceLine" id="cb9-2" title="2">r98p3 &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Table =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb9-4" title="4">    table <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;food&quot;</span>,</a>
<a class="sourceLine" id="cb9-5" title="5">    table <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;tobacco&quot;</span>,</a>
<a class="sourceLine" id="cb9-6" title="6">    table <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;clothing&quot;</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">    table <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;housing&quot;</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">    table <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;furniture&quot;</span>,</a>
<a class="sourceLine" id="cb9-9" title="9">    table <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;health&quot;</span>,</a>
<a class="sourceLine" id="cb9-10" title="10">    table <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;transport&quot;</span>,</a>
<a class="sourceLine" id="cb9-11" title="11">    table <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">~</span><span class="st"> &quot;communication&quot;</span>,</a>
<a class="sourceLine" id="cb9-12" title="12">    table <span class="op">==</span><span class="st"> </span><span class="dv">9</span> <span class="op">~</span><span class="st"> &quot;recreation&quot;</span>,</a>
<a class="sourceLine" id="cb9-13" title="13">    table <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">~</span><span class="st"> &quot;restaurant&quot;</span>,</a>
<a class="sourceLine" id="cb9-14" title="14">    table <span class="op">==</span><span class="st"> </span><span class="dv">12</span> <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</a>
<a class="sourceLine" id="cb9-15" title="15">    table <span class="op">==</span><span class="st"> </span><span class="dv">13</span> <span class="op">~</span><span class="st"> &quot;durables&quot;</span>,</a>
<a class="sourceLine" id="cb9-16" title="16">    table <span class="op">==</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> &quot;investment&quot;</span>,</a>
<a class="sourceLine" id="cb9-17" title="17">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="st">  </span><span class="kw">group_by</span>(Address,Table) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </a>
<a class="sourceLine" id="cb9-21" title="21">              <span class="dt">names_from =</span> <span class="st">&quot;Table&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;cost_&quot;</span>,</a>
<a class="sourceLine" id="cb9-22" title="22">              <span class="dt">values_from =</span> <span class="st">&quot;cost&quot;</span>, <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">cost =</span> <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb9-23" title="23"></a>
<a class="sourceLine" id="cb9-24" title="24">u98p3 &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Table =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb9-26" title="26">    table <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;food&quot;</span>,</a>
<a class="sourceLine" id="cb9-27" title="27">    table <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;tobacco&quot;</span>,</a>
<a class="sourceLine" id="cb9-28" title="28">    table <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;clothing&quot;</span>,</a>
<a class="sourceLine" id="cb9-29" title="29">    table <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;housing&quot;</span>,</a>
<a class="sourceLine" id="cb9-30" title="30">    table <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;furniture&quot;</span>,</a>
<a class="sourceLine" id="cb9-31" title="31">    table <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;health&quot;</span>,</a>
<a class="sourceLine" id="cb9-32" title="32">    table <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;transport&quot;</span>,</a>
<a class="sourceLine" id="cb9-33" title="33">    table <span class="op">==</span><span class="st"> </span><span class="dv">8</span> <span class="op">~</span><span class="st"> &quot;communication&quot;</span>,</a>
<a class="sourceLine" id="cb9-34" title="34">    table <span class="op">==</span><span class="st"> </span><span class="dv">9</span> <span class="op">~</span><span class="st"> &quot;recreation&quot;</span>,</a>
<a class="sourceLine" id="cb9-35" title="35">    table <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">~</span><span class="st"> &quot;restaurant&quot;</span>,</a>
<a class="sourceLine" id="cb9-36" title="36">    table <span class="op">==</span><span class="st"> </span><span class="dv">12</span> <span class="op">~</span><span class="st"> &quot;miscellaneous&quot;</span>,</a>
<a class="sourceLine" id="cb9-37" title="37">    table <span class="op">==</span><span class="st"> </span><span class="dv">13</span> <span class="op">~</span><span class="st"> &quot;durables&quot;</span>,</a>
<a class="sourceLine" id="cb9-38" title="38">    table <span class="op">==</span><span class="st"> </span><span class="dv">14</span> <span class="op">~</span><span class="st"> &quot;investment&quot;</span>,</a>
<a class="sourceLine" id="cb9-39" title="39">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="st">  </span><span class="kw">group_by</span>(Address,Table) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-41" title="41"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cost =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </a>
<a class="sourceLine" id="cb9-43" title="43">              <span class="dt">names_from =</span> <span class="st">&quot;Table&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;cost_&quot;</span>,</a>
<a class="sourceLine" id="cb9-44" title="44">              <span class="dt">values_from =</span> <span class="st">&quot;cost&quot;</span>, <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">cost =</span> <span class="dv">0</span>))</a></code></pre></div>
<p>We build non-monetary income as follows and then merge all income tables into one</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Non-monetary household income</span></a>
<a class="sourceLine" id="cb10-2" title="2">r_NMincome &lt;-<span class="st"> </span>R98P3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb10-4" title="4">    purchased <span class="op">%in%</span><span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;private&quot;</span>,</a>
<a class="sourceLine" id="cb10-6" title="6">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;agriculture&quot;</span>,</a>
<a class="sourceLine" id="cb10-7" title="7">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;nonagriculture&quot;</span>, </a>
<a class="sourceLine" id="cb10-8" title="8">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(Address, type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">value =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(type)<span class="op">&amp;</span>value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </a>
<a class="sourceLine" id="cb10-13" title="13">              <span class="dt">names_from=</span><span class="st">&quot;type&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;income_nm_&quot;</span>, </a>
<a class="sourceLine" id="cb10-14" title="14">              <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>,  <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">value =</span> <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb10-15" title="15"></a>
<a class="sourceLine" id="cb10-16" title="16">u_NMincome &lt;-<span class="st"> </span>U98P3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb10-18" title="18">    purchased <span class="op">%in%</span><span class="st"> </span><span class="dv">3</span><span class="op">:</span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;public&quot;</span>,</a>
<a class="sourceLine" id="cb10-19" title="19">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="op">~</span><span class="st"> &quot;private&quot;</span>,</a>
<a class="sourceLine" id="cb10-20" title="20">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">6</span> <span class="op">~</span><span class="st"> &quot;agriculture&quot;</span>,</a>
<a class="sourceLine" id="cb10-21" title="21">    purchased <span class="op">==</span><span class="st"> </span><span class="dv">7</span> <span class="op">~</span><span class="st"> &quot;nonagriculture&quot;</span>, </a>
<a class="sourceLine" id="cb10-22" title="22">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="st">  </span><span class="kw">group_by</span>(Address, type) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">value =</span> <span class="kw">sum</span>(value, <span class="dt">na.rm =</span> T)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(type)<span class="op">&amp;</span>value<span class="op">!=</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="st">  </span><span class="kw">pivot_wider</span>(Address, </a>
<a class="sourceLine" id="cb10-27" title="27">              <span class="dt">names_from=</span><span class="st">&quot;type&quot;</span>, <span class="dt">names_prefix =</span> <span class="st">&quot;income_nm_&quot;</span>, </a>
<a class="sourceLine" id="cb10-28" title="28">              <span class="dt">values_from =</span> <span class="st">&quot;value&quot;</span>, <span class="dt">values_fill =</span> <span class="kw">list</span>(<span class="dt">value =</span> <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb10-29" title="29"></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="co"># sum of household income</span></a>
<a class="sourceLine" id="cb10-31" title="31">r_incomeSum &lt;-<span class="st"> </span>Rind98 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="kw">starts_with</span>(<span class="kw">c</span>(<span class="st">&quot;income&quot;</span>,<span class="st">&quot;netincome&quot;</span>)),<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a>
<a class="sourceLine" id="cb10-34" title="34"></a>
<a class="sourceLine" id="cb10-35" title="35">u_incomeSum &lt;-<span class="st"> </span>Uind98 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="st">  </span><span class="kw">group_by</span>(Address) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">across</span>(<span class="kw">c</span>(<span class="kw">starts_with</span>(<span class="kw">c</span>(<span class="st">&quot;income&quot;</span>,<span class="st">&quot;netincome&quot;</span>)),<span class="st">&quot;subsidy&quot;</span>), <span class="op">~</span><span class="kw">sum</span>(.x,<span class="dt">na.rm =</span> T)))</a></code></pre></div>
<p>Finally, we merge all household level data as save it as dataframe names as <em>HH98.Rds</em></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># merging household-level data</span></a>
<a class="sourceLine" id="cb11-2" title="2">RHH98 &lt;-<span class="st"> </span>r98data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;R&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="st">  </span><span class="kw">left_join</span>(r98p1, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="st">  </span><span class="kw">left_join</span>(r_head, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="st">  </span><span class="kw">left_join</span>(r_job, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="st">  </span><span class="kw">left_join</span>(r98p3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="st">  </span><span class="kw">left_join</span>(r_incomeSum, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="st">  </span><span class="kw">left_join</span>(r_NMincome, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="st">  </span><span class="kw">left_join</span>(R98P2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(income_w_y<span class="op">:</span>income_nm_nonagriculture, <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(.x),<span class="dv">0</span>,.x)))</a>
<a class="sourceLine" id="cb11-12" title="12"></a>
<a class="sourceLine" id="cb11-13" title="13">UHH98 &lt;-<span class="st"> </span>u98data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="st">&quot;U&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="st">  </span><span class="kw">left_join</span>(u98p1, <span class="dt">by=</span><span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="st">  </span><span class="kw">left_join</span>(r_head, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="st">  </span><span class="kw">left_join</span>(u_job, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="st">  </span><span class="kw">left_join</span>(u98p3, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="st">  </span><span class="kw">left_join</span>(u_incomeSum, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="st">  </span><span class="kw">left_join</span>(u_NMincome, <span class="dt">by =</span> <span class="st">&quot;Address&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="st">  </span><span class="kw">left_join</span>(U98P2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(income_w_y<span class="op">:</span>income_nm_nonagriculture, <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">is.na</span>(.x),<span class="dv">0</span>,.x)))</a>
<a class="sourceLine" id="cb11-23" title="23"></a>
<a class="sourceLine" id="cb11-24" title="24">HH98 &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(RHH98, UHH98) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">urban =</span> <span class="kw">as.factor</span>(urban)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="st">  </span><span class="kw">as.data.frame</span>()</a>
<a class="sourceLine" id="cb11-27" title="27"></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="kw">saveRDS</span>(HH98, <span class="dt">file =</span> <span class="st">&quot;./exported/HH98.Rds&quot;</span>)</a></code></pre></div>
<div id="exporting-to-other-formats." class="section level3">
<h3><span class="header-section-number">4.8.1</span> Exporting to other formats.</h3>
<p>The <em>Rds</em> files can be easily converted to other formats using proper <em>R</em> package. The package “haven” is a good choice to convert to ‘STATA’, ‘SPSS’, and ‘SAS’.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co">#######################################</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co"># Exporting Rds files to CSV, STATA, etc.</span></a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#install.packages(&quot;haven&quot;) # uncomment if not already installed</span></a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6">df &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;./exported/HH98.Rds&quot;</span>) <span class="co"># Specify the Rds file to convert here</span></a>
<a class="sourceLine" id="cb12-7" title="7"></a>
<a class="sourceLine" id="cb12-8" title="8">haven<span class="op">::</span><span class="kw">write_dta</span>(df, <span class="st">&quot;./exported/HH98.dta&quot;</span>) <span class="co"># to export in STATA</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">write_csv2</span>(df, <span class="st">&quot;./exported/HH98.csv&quot;</span>) <span class="co"># to export in CSV</span></a></code></pre></div>
</div>
</div>
<div id="special-issues-for-different-years" class="section level2">
<h2><span class="header-section-number">4.9</span> Special issues for different years</h2>
<p><span style="color:red"> Was there any specific issue that we have to correct in a specific round except what explained above? Like the number of items etc. </span></p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>A minor note on coding: this part of the code can be speeded up using <em>data.table</em> package instead of using summarize of <em>dplyr</em>. But because the <em>dplyr</em> coding is more intuitive we stick to it.<a href="cleaning-data.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="importing-raw-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="price-adjustment-and-appending.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
